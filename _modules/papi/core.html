<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>papi.core &mdash; papi v.1.4 documentation</title>
    
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     'v.1.4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="papi v.1.4 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
    
        <li><a href="../../index.html">papi v.1.4 documentation</a> &raquo;</li>
    <li><a href="https://github.com/TUB-Control/PaPI">GitHub</a> &raquo;</li>

          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for papi.core</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/python3</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Copyright (C) 2014 Technische Universität Berlin,</span>
<span class="sd">Fakultät IV - Elektrotechnik und Informatik,</span>
<span class="sd">Fachgebiet Regelungssysteme,</span>
<span class="sd">Einsteinufer 17, D-10587 Berlin, Germany</span>

<span class="sd">This file is part of PaPI.</span>

<span class="sd">PaPI is free software: you can redistribute it and/or modify</span>
<span class="sd">it under the terms of the GNU General Public License as published by</span>
<span class="sd">the Free Software Foundation, either version 3 of the License, or</span>
<span class="sd">(at your option) any later version.</span>

<span class="sd">PaPI is distributed in the hope that it will be useful,</span>
<span class="sd">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="sd">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="sd">GNU General Public License for more details.</span>

<span class="sd">You should have received a copy of the GNU General Public License</span>
<span class="sd">along with PaPI.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>

<span class="sd">Contributors</span>
<span class="sd">Stefan Ruppin</span>
<span class="sd">&quot;&quot;&quot;</span>



<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Process</span><span class="p">,</span> <span class="n">Queue</span>
<span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Timer</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">papi.yapsy.PluginManager</span> <span class="kn">import</span> <span class="n">PluginManager</span>
<span class="kn">from</span> <span class="nn">papi.data.DCore</span> <span class="kn">import</span> <span class="n">DCore</span>
<span class="kn">from</span> <span class="nn">papi.data.DPlugin</span> <span class="kn">import</span> <span class="n">DPlugin</span><span class="p">,</span> <span class="n">DBlock</span>
<span class="kn">from</span> <span class="nn">papi.data.DSignal</span> <span class="kn">import</span> <span class="n">DSignal</span>
<span class="kn">from</span> <span class="nn">papi.ConsoleLog</span> <span class="kn">import</span> <span class="n">ConsoleLog</span>
<span class="kn">from</span> <span class="nn">papi.data.DOptionalData</span> <span class="kn">import</span> <span class="n">DOptionalData</span>

<span class="kn">import</span> <span class="nn">papi.constants</span> <span class="kn">as</span> <span class="nn">pc</span>

<span class="kn">from</span> <span class="nn">papi.constants</span> <span class="kn">import</span> <span class="n">CORE_PROCESS_CONSOLE_IDENTIFIER</span><span class="p">,</span> <span class="n">CORE_CONSOLE_LOG_LEVEL</span><span class="p">,</span> <span class="n">CORE_PAPI_CONSOLE_START_MESSAGE</span><span class="p">,</span> \
    <span class="n">CORE_CORE_CONSOLE_START_MESSAGE</span><span class="p">,</span> <span class="n">CORE_ALIVE_CHECK_ENABLED</span><span class="p">,</span> \
    <span class="n">CORE_STOP_CONSOLE_MESSAGE</span><span class="p">,</span> <span class="n">CORE_ALIVE_CHECK_INTERVAL</span><span class="p">,</span> <span class="n">CORE_ALIVE_MAX_COUNT</span><span class="p">,</span> <span class="n">CORE_TIME_SIGNAL</span>

<span class="kn">from</span> <span class="nn">papi.constants</span> <span class="kn">import</span> <span class="n">PLUGIN_ROOT_FOLDER_LIST</span><span class="p">,</span> <span class="n">PLUGIN_VIP_IDENTIFIER</span><span class="p">,</span> \
    <span class="n">PLUGIN_DPP_IDENTIFIER</span><span class="p">,</span> <span class="n">PLUGIN_STATE_PAUSE</span><span class="p">,</span> <span class="n">PLUGIN_STATE_RESUMED</span><span class="p">,</span> \
    <span class="n">PLUGIN_STATE_START_SUCCESFUL</span><span class="p">,</span> <span class="n">PLUGIN_STATE_START_FAILED</span><span class="p">,</span> <span class="n">PLUGIN_STATE_ALIVE</span><span class="p">,</span> <span class="n">PLUGIN_STATE_STOPPED</span><span class="p">,</span> \
    <span class="n">PLUGIN_STATE_DEAD</span>

<span class="kn">import</span> <span class="nn">papi.error_codes</span> <span class="kn">as</span> <span class="nn">ERROR</span>

<span class="kn">from</span> <span class="nn">papi.event.event_base</span> <span class="kn">import</span> <span class="n">PapiEventBase</span>
<span class="kn">import</span> <span class="nn">papi.event</span> <span class="kn">as</span> <span class="nn">Event</span>

<span class="kn">import</span> <span class="nn">signal</span>

<div class="viewcode-block" id="run_core_in_own_process"><a class="viewcode-back" href="../../papi.html#papi.core.run_core_in_own_process">[docs]</a><span class="k">def</span> <span class="nf">run_core_in_own_process</span><span class="p">(</span><span class="n">gui_queue</span><span class="p">,</span> <span class="n">core_queue</span><span class="p">,</span> <span class="n">gui_id</span><span class="p">):</span>
    <span class="n">core</span> <span class="o">=</span> <span class="n">Core</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="bp">False</span><span class="p">,</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">core</span><span class="o">.</span><span class="n">gui_id</span> <span class="o">=</span> <span class="n">gui_id</span>
    <span class="n">core</span><span class="o">.</span><span class="n">core_event_queue</span> <span class="o">=</span> <span class="n">core_queue</span>
    <span class="n">core</span><span class="o">.</span><span class="n">gui_event_queue</span> <span class="o">=</span> <span class="n">gui_queue</span>

    <span class="n">core</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Process_dummy"><a class="viewcode-back" href="../../papi.html#papi.core.Process_dummy">[docs]</a><span class="k">class</span> <span class="nc">Process_dummy</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pid</span><span class="o">=</span> <span class="mi">0</span>
</div>
<div class="viewcode-block" id="Core"><a class="viewcode-back" href="../../papi.html#papi.core.Core">[docs]</a><span class="k">class</span> <span class="nc">Core</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gui_start_function</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">use_gui</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">is_parent</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">gui_process_pid</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Init function of the PaPI Core.</span>
<span class="sd">        Creates all data needed to use core and core.run() functions</span>

<span class="sd">        .. document private functions</span>
<span class="sd">        .. automethod:: __*</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># switch case structure for processing incoming events</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__process_event_by_type__</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;status_event&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_status_event__</span><span class="p">,</span>
                                          <span class="s">&#39;data_event&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_data_event__</span><span class="p">,</span>
                                          <span class="s">&#39;instr_event&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_instr_event__</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__process_status_event_l__</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;start_successfull&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_start_successfull__</span><span class="p">,</span>
                                           <span class="s">&#39;start_failed&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_start_failed__</span><span class="p">,</span>
                                           <span class="s">&#39;alive&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_alive__</span><span class="p">,</span>
                                           <span class="s">&#39;join_request&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_join_request__</span><span class="p">,</span>
                                           <span class="s">&#39;plugin_stopped&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_plugin_stopped__</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__process_data_event_l__</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;new_data&#39;</span><span class="p">:</span>                <span class="bp">self</span><span class="o">.</span><span class="n">__process_new_data__</span><span class="p">,</span>
                                         <span class="s">&#39;new_block&#39;</span><span class="p">:</span>               <span class="bp">self</span><span class="o">.</span><span class="n">__process_new_block__</span><span class="p">,</span>
                                         <span class="s">&#39;new_parameter&#39;</span><span class="p">:</span>           <span class="bp">self</span><span class="o">.</span><span class="n">__process_new_parameter__</span><span class="p">,</span>
                                         <span class="s">&#39;edit_dplugin&#39;</span><span class="p">:</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__process_edit_dplugin</span><span class="p">,</span>
                                         <span class="s">&#39;edit_dplugin_by_uname&#39;</span><span class="p">:</span>   <span class="bp">self</span><span class="o">.</span><span class="n">__process_edit_dplugin_by_uname__</span><span class="p">,</span>
                                         <span class="s">&#39;delete_block&#39;</span><span class="p">:</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__process_delete_block__</span><span class="p">,</span>
                                         <span class="s">&#39;delete_parameter&#39;</span><span class="p">:</span>        <span class="bp">self</span><span class="o">.</span><span class="n">__process_delete_parameter__</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__process_instr_event_l__</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;create_plugin&#39;</span><span class="p">:</span>          <span class="bp">self</span><span class="o">.</span><span class="n">__process_create_plugin__</span><span class="p">,</span>
                                          <span class="s">&#39;stop_plugin&#39;</span><span class="p">:</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__process_stop_plugin__</span><span class="p">,</span>
                                          <span class="s">&#39;stop_plugin_by_uname&#39;</span><span class="p">:</span>   <span class="bp">self</span><span class="o">.</span><span class="n">__process_stop_plugin_by_uname__</span><span class="p">,</span>
                                          <span class="s">&#39;close_program&#39;</span><span class="p">:</span>          <span class="bp">self</span><span class="o">.</span><span class="n">__process_close_programm__</span><span class="p">,</span>
                                          <span class="s">&#39;subscribe&#39;</span><span class="p">:</span>              <span class="bp">self</span><span class="o">.</span><span class="n">__process_subscribe__</span><span class="p">,</span>
                                          <span class="s">&#39;subscribe_by_uname&#39;</span><span class="p">:</span>     <span class="bp">self</span><span class="o">.</span><span class="n">__process_subscribe_by_uname__</span><span class="p">,</span>
                                          <span class="s">&#39;unsubscribe&#39;</span><span class="p">:</span>            <span class="bp">self</span><span class="o">.</span><span class="n">__process_unsubsribe__</span><span class="p">,</span>
                                          <span class="s">&#39;set_parameter&#39;</span><span class="p">:</span>          <span class="bp">self</span><span class="o">.</span><span class="n">__process_set_parameter__</span><span class="p">,</span>
                                          <span class="s">&#39;set_parameter_by_uname&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_set_parameter__</span><span class="p">,</span>
                                          <span class="s">&#39;pause_plugin&#39;</span><span class="p">:</span>           <span class="bp">self</span><span class="o">.</span><span class="n">__process_pause_plugin__</span><span class="p">,</span>
                                          <span class="s">&#39;resume_plugin&#39;</span><span class="p">:</span>          <span class="bp">self</span><span class="o">.</span><span class="n">__process_resume_plugin__</span><span class="p">,</span>
                                          <span class="s">&#39;start_plugin&#39;</span><span class="p">:</span>           <span class="bp">self</span><span class="o">.</span><span class="n">__process_start_plugin__</span>
        <span class="p">}</span>

        <span class="c"># Startup parameter to configure core</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_parent</span> <span class="o">=</span> <span class="n">is_parent</span>

        <span class="c"># creating the main core data object DCore and core queue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span> <span class="o">=</span> <span class="n">DCore</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">core_goOn</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">core_id</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c"># setting up the yapsy plugin manager for directory structure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plugin_manager</span> <span class="o">=</span> <span class="n">PluginManager</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plugin_manager</span><span class="o">.</span><span class="n">setPluginPlaces</span><span class="p">(</span><span class="n">PLUGIN_ROOT_FOLDER_LIST</span><span class="p">)</span>

        <span class="c"># define gui information. ID and alive status as well as gui queue for events</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gui_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">create_id</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gui_alive</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_gui</span> <span class="o">=</span> <span class="n">use_gui</span>

        <span class="c"># set information for console logging part (debug information)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">ConsoleLog</span><span class="p">(</span><span class="n">CORE_CONSOLE_LOG_LEVEL</span><span class="p">,</span> <span class="n">CORE_PROCESS_CONSOLE_IDENTIFIER</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">lvl</span> <span class="o">=</span> <span class="n">pc</span><span class="o">.</span><span class="n">CORE_CONSOLE_LOG_LEVEL</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">debug_level</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">lvl</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">debug_level</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c"># define variables for check alive system, e.a. timer and counts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alive_interval</span> <span class="o">=</span> <span class="n">CORE_ALIVE_CHECK_INTERVAL</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alive_count_max</span> <span class="o">=</span> <span class="n">CORE_ALIVE_MAX_COUNT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alive_timer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alive_interval</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_alive_callback</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alive_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gui_alive_count</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c"># Setup queues and processes for inter-process communication between core and gui</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">core_event_queue</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gui_event_queue</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gui_process</span> <span class="o">=</span> <span class="n">Process_dummy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gui_process</span><span class="o">.</span><span class="n">pid</span> <span class="o">=</span> <span class="n">gui_process_pid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gui_alive</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="c"># Check whether core is set to be parent and then check parameter to be valid</span>
        <span class="k">if</span> <span class="n">is_parent</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">gui_start_function</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Core started with wrong arguments&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">use_gui</span> <span class="ow">is</span> <span class="bp">True</span> <span class="ow">and</span> <span class="n">is_parent</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
                 <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Core started with wrong arguments&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">is_parent</span> <span class="ow">is</span> <span class="bp">False</span> <span class="ow">and</span> <span class="n">gui_process_pid</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                 <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Core started with wrong arguments&#39;</span><span class="p">)</span>

            <span class="c"># core is set to be parent, start gui process from core</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gui_start_function</span> <span class="o">=</span> <span class="n">gui_start_function</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">core_event_queue</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gui_event_queue</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">()</span>

        <span class="c"># list/queue for events that should be delayed before execution</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">core_delayed_operation_queue</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># connect CTRL+C signaling from cmd to quit PaPI</span>
        <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">sig</span><span class="p">,</span><span class="n">frame</span><span class="p">,</span><span class="n">core</span><span class="o">=</span><span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">signal_handler</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span><span class="n">frame</span><span class="p">,</span><span class="n">core</span><span class="p">))</span>

<div class="viewcode-block" id="Core.run"><a class="viewcode-back" href="../../papi.html#papi.core.Core.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Main operation function of core.</span>
<span class="sd">        Event loop is in here.</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># logs: some startup information</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">CORE_PAPI_CONSOLE_START_MESSAGE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">CORE_CORE_CONSOLE_START_MESSAGE</span> <span class="o">+</span> <span class="s">&#39; .. Process id: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()))</span>

        <span class="c"># start the GUI process to show GUI, set GUI alive status to TRUE</span>
        <span class="c"># don&#39;t start GUI in case that CORE is not parent and that the gui should be used</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_gui</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_parent</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gui_process</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gui_start_function</span><span class="p">,</span>
                                       <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">core_event_queue</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui_event_queue</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gui_process</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="c"># start the check alive timer if heartbeat is activated</span>
        <span class="k">if</span> <span class="n">CORE_ALIVE_CHECK_ENABLED</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;Alive check of processes is enabled&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alive_timer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="c"># core main operation loop</span>
        <span class="c"># Receiving and reaction to events</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_goOn</span><span class="p">:</span>
            <span class="c"># get event from queue, blocks until there is a new event</span>
            <span class="c"># blocking prevents unnecessary iterations since core is only reacting to events</span>
            <span class="n">event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_event_queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

            <span class="c"># LOG: Debug output</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">&#39;Event-&gt;&#39;</span> <span class="o">+</span> <span class="n">event</span><span class="o">.</span><span class="n">get_eventtype</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;   &#39;</span> <span class="o">+</span> <span class="n">event</span><span class="o">.</span><span class="n">get_event_operation</span><span class="p">())</span>

            <span class="c"># process the next event of queue</span>
            <span class="c"># catch error if event is unknown, i.e. no callback function exits for it</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__process_event__</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">Exc</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">Exc</span><span class="p">)</span>

            <span class="c"># check if there are still plugins alive or gui is still alive before ending core main loop</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">core_goOn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">get_dplugins_count</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui_alive</span>

        <span class="c"># core main loop ended, so cancel alive timer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alive_timer</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>

        <span class="c"># LOG: core finished operation and did clean shutdown</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">CORE_STOP_CONSOLE_MESSAGE</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Core.signal_handler"><a class="viewcode-back" href="../../papi.html#papi.core.Core.signal_handler">[docs]</a>    <span class="k">def</span> <span class="nf">signal_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">signal</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span><span class="n">core</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback-handler for signal from cmd line like e.g. SIGINT</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Core.send_alive_check_events"><a class="viewcode-back" href="../../papi.html#papi.core.Core.send_alive_check_events">[docs]</a>    <span class="k">def</span> <span class="nf">send_alive_check_events</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for check_alive_status timer to send check_alive events to all running processes</span>
<span class="sd">        This will trigger all correctly running processes to send an answer to core.</span>
<span class="sd">        Alive response is handled in method &#39;__process_alive__&#39;</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># get list of all plugins [hash: id-&gt;dplug], type DPlugin</span>
        <span class="n">dplugs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">get_all_plugins</span><span class="p">()</span>
        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">dplugs</span><span class="p">:</span>
            <span class="c"># get dplugin object</span>
            <span class="n">plug</span> <span class="o">=</span> <span class="n">dplugs</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>
            <span class="c"># check if this plugin runs in a separate process</span>
            <span class="k">if</span> <span class="n">plug</span><span class="o">.</span><span class="n">own_process</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                <span class="c"># send check_alive_status event to plugin process (via queue)</span>
                <span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">CheckAliveStatus</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">core_id</span><span class="p">,</span> <span class="n">plug</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
                <span class="n">plug</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

        <span class="c"># send check_alive_status event to gui process (via queue)</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">CheckAliveStatus</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">core_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui_id</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gui_event_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Core.handle_alive_situation"><a class="viewcode-back" href="../../papi.html#papi.core.Core.handle_alive_situation">[docs]</a>    <span class="k">def</span> <span class="nf">handle_alive_situation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function which handles the check for the alive situation of all plugins in data base</span>
<span class="sd">        Will distribute to error_handling methods to handle dead processes</span>
<span class="sd">        This is no callback functions, more a rather periodically called method to check the alive situation.</span>
<span class="sd">        Is called by the handler which handles the alive timer callbacks</span>

<span class="sd">        It checks the counter of the plugins and compares them against the core counter. A not equal (normally smaller)</span>
<span class="sd">        number in the plugin object indicates a dead process. A error handler is called.</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># get all plugins from core data [hash: id-&gt;DPlugin]</span>
        <span class="n">dplugs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">get_all_plugins</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">dplugs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">dplugs</span><span class="p">:</span>
                <span class="c"># get DPlugin object</span>
                <span class="n">plug</span> <span class="o">=</span> <span class="n">dplugs</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>
                <span class="c"># check if plugins runs in a separate process</span>
                <span class="k">if</span> <span class="n">plug</span><span class="o">.</span><span class="n">own_process</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                    <span class="c"># check if counts are equal: equal indicates that plugin is alive</span>
                    <span class="k">if</span> <span class="n">plug</span><span class="o">.</span><span class="n">alive_count</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">alive_count</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">&#39;Plugin &#39;</span> <span class="o">+</span> <span class="n">plug</span><span class="o">.</span><span class="n">uname</span> <span class="o">+</span> <span class="s">&#39; is still alive&#39;</span><span class="p">)</span>
                        <span class="c"># change plugin state in DCore</span>
                        <span class="n">plug</span><span class="o">.</span><span class="n">alive_state</span> <span class="o">=</span> <span class="n">PLUGIN_STATE_ALIVE</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c"># Plugin is not alive anymore, so do error handling</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">plugin_process_is_dead_error_handler</span><span class="p">(</span><span class="n">plug</span><span class="p">)</span>

            <span class="c"># check for gui status and do error handling</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui_alive_count</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">alive_count</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">&#39;GUI  is still ALIVE&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gui_is_dead_error_handler</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Core.gui_is_dead_error_handler"><a class="viewcode-back" href="../../papi.html#papi.core.Core.gui_is_dead_error_handler">[docs]</a>    <span class="k">def</span> <span class="nf">gui_is_dead_error_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Error handler for the case that the gui is dead.</span>
<span class="sd">        The handler gets called by the method &#39;handle_alive_situation&#39; in case the gui counter does not match</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;GUI  is  DEAD&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                           <span class="s">&#39;core count: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alive_count</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; vs. &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gui_alive_count</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; :gui count&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Core.plugin_process_is_dead_error_handler"><a class="viewcode-back" href="../../papi.html#papi.core.Core.plugin_process_is_dead_error_handler">[docs]</a>    <span class="k">def</span> <span class="nf">plugin_process_is_dead_error_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dplug</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Error handler for the case that the a plugin is dead.</span>
<span class="sd">        The handler gets called by the method &#39;handle_alive_situation&#39; in case the plugin counter does not match</span>

<span class="sd">        :param dplug: Plugin which is dead</span>
<span class="sd">        :type dplug: DPlugin</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># LOG: print situation to the console</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;Plugin &#39;</span> <span class="o">+</span> <span class="n">dplug</span><span class="o">.</span><span class="n">uname</span> <span class="o">+</span> <span class="s">&#39; is DEAD&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                           <span class="s">&#39;core count: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alive_count</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; vs. &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">dplug</span><span class="o">.</span><span class="n">alive_count</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; :plugin count&#39;</span><span class="p">)</span>

        <span class="c"># set the plugin state to DEAD and update meta data to let the GUI know</span>
        <span class="n">dplug</span><span class="o">.</span><span class="n">alive_state</span> <span class="o">=</span> <span class="n">PLUGIN_STATE_DEAD</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_meta_data_to_gui</span><span class="p">(</span><span class="n">dplug</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Core.check_alive_callback"><a class="viewcode-back" href="../../papi.html#papi.core.Core.check_alive_callback">[docs]</a>    <span class="k">def</span> <span class="nf">check_alive_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback function for check_alive status timer, get called every time the timer triggers, does sth and starts a</span>
<span class="sd">        new timer.</span>
<span class="sd">        Handles sending events to processes and checking their answer.</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># LOG: alive timer triggered</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">&#39;check alive&#39;</span><span class="p">)</span>

        <span class="c"># check for answer status of all plugins</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handle_alive_situation</span><span class="p">()</span>

        <span class="c"># increase the global check_alive counter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alive_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alive_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alive_count</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">alive_count_max</span>

        <span class="c"># send new check alive events to plugins</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_alive_check_events</span><span class="p">()</span>

        <span class="c"># start a new one shot timer with this callback function as the next alive interval</span>
        <span class="k">if</span> <span class="n">CORE_ALIVE_CHECK_ENABLED</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alive_timer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alive_interval</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_alive_callback</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alive_timer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Core.update_meta_data_to_gui"><a class="viewcode-back" href="../../papi.html#papi.core.Core.update_meta_data_to_gui">[docs]</a>    <span class="k">def</span> <span class="nf">update_meta_data_to_gui</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pl_id</span><span class="p">,</span> <span class="n">inform_subscriber</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        On call, this function sends the meta information of the plugin with pl_id to the GUI</span>
<span class="sd">        With meta information is meant: all data in the dplugin object which is not process related (e.g. ids, names,</span>
<span class="sd">        states, subscriptions)</span>
<span class="sd">        The methods should be called everywhere, where some of those information are changed and a update in other</span>
<span class="sd">        processes is required/wanted. Additionally, subscriber of the plugin &#39;pl_id&#39; are informed/</span>

<span class="sd">        The methods takes the dplugin specified by its id and extracts all the meta data. Then, sends the updated meta</span>
<span class="sd">        data to the gui. Afterwards, if required, the subscriber will be informed by calling this methods (some kind of</span>
<span class="sd">        recursive) again with another id.</span>

<span class="sd">        :param pl_id: id of plugin with new meta information</span>
<span class="sd">        :type pl_id: int</span>
<span class="sd">        :param inform_subscriber: flag used to determine if a meta_update for all subscriber should be initiated</span>
<span class="sd">        :type inform_subscriber: bool</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># get DPlugin object with id and check if it exists</span>
        <span class="n">dplugin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">get_dplugin_by_id</span><span class="p">(</span><span class="n">pl_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dplugin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># DPlugin object exists,so build optionalData for Event</span>
            <span class="n">optObj</span> <span class="o">=</span> <span class="n">DOptionalData</span><span class="p">()</span>
            <span class="c"># get meta information of DPlugin and add it to the event</span>
            <span class="n">optObj</span><span class="o">.</span><span class="n">plugin_object</span> <span class="o">=</span> <span class="n">dplugin</span><span class="o">.</span><span class="n">get_meta</span><span class="p">()</span>
            <span class="c"># build event and send it to GUI with meta information</span>
            <span class="n">eventMeta</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">instruction</span><span class="o">.</span><span class="n">UpdateMeta</span><span class="p">(</span><span class="n">pl_id</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">gui_id</span><span class="p">,</span><span class="n">optObj</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gui_event_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">eventMeta</span><span class="p">)</span>

            <span class="c"># check if plugin got some subscribers which run in own process</span>
            <span class="k">if</span> <span class="n">dplugin</span><span class="o">.</span><span class="n">own_process</span> <span class="ow">is</span> <span class="bp">True</span> <span class="ow">and</span> <span class="n">dplugin</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">PLUGIN_STATE_START_SUCCESFUL</span><span class="p">:</span>
                <span class="n">dplugin</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">eventMeta</span><span class="p">)</span>

            <span class="c"># ---------------------------------------------</span>
            <span class="c"># Inform all subscriber if needed and wished</span>
            <span class="c"># ---------------------------------------------</span>
            <span class="k">if</span> <span class="n">inform_subscriber</span><span class="p">:</span>
                <span class="c"># get all blocks of the plugin to search for subscriber</span>
                <span class="n">dblocks</span> <span class="o">=</span> <span class="n">dplugin</span><span class="o">.</span><span class="n">get_dblocks</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">dblock_name</span> <span class="ow">in</span> <span class="n">dblocks</span><span class="p">:</span>
                    <span class="c"># search in all blocks for subscriber</span>
                    <span class="n">dblock</span> <span class="o">=</span> <span class="n">dblocks</span><span class="p">[</span><span class="n">dblock_name</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">subscriber_id</span> <span class="ow">in</span> <span class="n">dblock</span><span class="o">.</span><span class="n">get_subscribers</span><span class="p">():</span>
                        <span class="c"># for every subscriber of a block of the plugin, check if it runs in its own process (not in gui)</span>
                        <span class="c"># to inform that process by a message (recursive call of this function)</span>
                        <span class="n">dplugin_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">get_dplugin_by_id</span><span class="p">(</span><span class="n">subscriber_id</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">dplugin_sub</span><span class="o">.</span><span class="n">own_process</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">update_meta_data_to_gui</span><span class="p">(</span><span class="n">dplugin_sub</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
            <span class="c"># return 1 if plugin exists and everything went fine in the update process</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Dplugin object with pl_id does not exist in DCore of core</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                               <span class="s">&#39;update_meta, cannot update meta information because there is no plugin with id: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                   <span class="n">pl_id</span><span class="p">))</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</div>
<div class="viewcode-block" id="Core.update_meta_data_to_gui_for_all"><a class="viewcode-back" href="../../papi.html#papi.core.Core.update_meta_data_to_gui_for_all">[docs]</a>    <span class="k">def</span> <span class="nf">update_meta_data_to_gui_for_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This functions update the meta data of all plugins to the GUI process by iteration over the plugin database</span>
<span class="sd">        and calling &#39;update_meta_data_to_gui&#39; for every plugin id.</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># iterate over plugin database</span>
        <span class="n">plugins</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">get_all_plugins</span><span class="p">()</span>
        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">plugins</span><span class="p">:</span>
            <span class="c"># update meta data of plugin id to gui</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_meta_data_to_gui</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Core.handle_parameter_change"><a class="viewcode-back" href="../../papi.html#papi.core.Core.handle_parameter_change">[docs]</a>    <span class="k">def</span> <span class="nf">handle_parameter_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plugin</span><span class="p">,</span> <span class="n">parameter_name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function should be called whenever there is a new_data event for changing a parameter value</span>
<span class="sd">        This function changes the value in DCore and updates this information to the GUI via a meta update</span>

<span class="sd">        :param plugin: Plugin which owns the parameter</span>
<span class="sd">        :type plugin: DPlugin</span>
<span class="sd">        :param parameter_name: Name of the parameter which value should be changed</span>
<span class="sd">        :type parameter_name: basestring</span>
<span class="sd">        :param value: new value for the parameter</span>
<span class="sd">        :type value: all possible, depends on plugin</span>
<span class="sd">        :return: -1 for error(parameter with parameter_name does not exist in plugin), 1 for o.k., done</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># gets the parameter list of the plugin for witch a parameter was changed</span>
        <span class="n">allparas</span> <span class="o">=</span> <span class="n">plugin</span><span class="o">.</span><span class="n">get_parameters</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">parameter_name</span> <span class="ow">in</span> <span class="n">allparas</span><span class="p">:</span>
            <span class="c"># parameter exists in the plugin, so change its value.</span>
            <span class="n">para</span> <span class="o">=</span> <span class="n">allparas</span><span class="p">[</span><span class="n">parameter_name</span><span class="p">]</span>
            <span class="n">para</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
            <span class="c"># Then, update the change to the gui by performing a meta update</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_meta_data_to_gui</span><span class="p">(</span><span class="n">plugin</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</div>
<div class="viewcode-block" id="Core.new_subscription"><a class="viewcode-back" href="../../papi.html#papi.core.Core.new_subscription">[docs]</a>    <span class="k">def</span> <span class="nf">new_subscription</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subscriber_id</span><span class="p">,</span> <span class="n">source_id</span><span class="p">,</span> <span class="n">block_name</span><span class="p">,</span> <span class="n">signals</span><span class="p">,</span> <span class="n">sub_alias</span><span class="p">,</span> <span class="n">orginal_event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets information of a new and desired subscription.</span>
<span class="sd">        This method will try to create the wanted subscription.</span>

<span class="sd">        :param subscriber_id: Id of the plugin that want to get data</span>
<span class="sd">        :param source_id:  Id of the plugin that will be the data source</span>
<span class="sd">        :param block_name:  name of source block of source plugin</span>
<span class="sd">        :param signals:  signals to subscribe</span>
<span class="sd">        :param sub_alias:  optional alias for parameter</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">already_sub</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="c"># check if already subscribed</span>
        <span class="n">source_pl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">get_dplugin_by_id</span><span class="p">(</span><span class="n">source_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">source_pl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># only check plugins which are started successfully, otherwise delay this operation.</span>
            <span class="k">if</span> <span class="n">source_pl</span><span class="o">.</span><span class="n">state</span> <span class="o">!=</span> <span class="n">PLUGIN_STATE_START_SUCCESFUL</span><span class="p">:</span>
                <span class="c"># source for subscription does not exists yet, so delay subscription event again</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">core_delayed_operation_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">orginal_event</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">&#39;subscribe, event was placed in delayed queue because plugin with id: &#39;</span>
                                   <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">source_id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; is still starting.&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="mi">0</span>

            <span class="c"># plugin is running correctly, so get its blocks to check if the subscriber already exists</span>
            <span class="n">blocks</span> <span class="o">=</span> <span class="n">source_pl</span><span class="o">.</span><span class="n">get_dblocks</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">block_name</span> <span class="ow">in</span> <span class="n">blocks</span><span class="p">:</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">blocks</span><span class="p">[</span><span class="n">block_name</span><span class="p">]</span>
                <span class="n">subs</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">get_subscribers</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">subscriber_id</span> <span class="ow">in</span> <span class="n">subs</span><span class="p">:</span>
                    <span class="c"># subscriber is already listed, so remember that</span>
                    <span class="n">already_sub</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="c"># Check if the subscription is necessary</span>
        <span class="k">if</span> <span class="n">already_sub</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">dsubscription</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">subscriber_id</span><span class="p">,</span> <span class="n">source_id</span><span class="p">,</span> <span class="n">block_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dsubscription</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c"># subscription failed</span>
                <span class="c"># maybe the block does not exists yet, so delay subscription event again</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">core_delayed_operation_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">orginal_event</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;subscribe, something failed in subscription process with subscriber id: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="n">subscriber_id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;..target id:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">source_id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;..and block &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">block_name</span><span class="p">))</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># subscription correct</span>
                <span class="c"># set alias for parameter control (can be none if no parameter)</span>
                <span class="n">dsubscription</span><span class="o">.</span><span class="n">alias</span> <span class="o">=</span> <span class="n">sub_alias</span>
                <span class="c"># send event to plugin which will control this parameter with information of parameter</span>
                <span class="k">if</span> <span class="n">sub_alias</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">sub_pl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">get_dplugin_by_id</span><span class="p">(</span><span class="n">subscriber_id</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">sub_pl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">parameters</span> <span class="o">=</span> <span class="n">sub_pl</span><span class="o">.</span><span class="n">get_parameters</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">sub_alias</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
                            <span class="n">parameter</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="n">sub_alias</span><span class="p">]</span>
                            <span class="n">para_event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">ParameterInfo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">core_id</span><span class="p">,</span> <span class="n">source_id</span><span class="p">,</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">parameter</span><span class="p">)</span> <span class="p">)</span>
                            <span class="n">source_pl</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">para_event</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">signals</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">subscribe_signals</span><span class="p">(</span><span class="n">subscriber_id</span><span class="p">,</span> <span class="n">source_id</span><span class="p">,</span> <span class="n">block_name</span><span class="p">,</span> <span class="n">signals</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c"># subscription failed</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;subscribe, something failed in subsription process with subscriber id: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="n">subscriber_id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;..target id:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">source_id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;..and block &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">block_name</span><span class="p">)</span>
                                   <span class="o">+</span> <span class="s">&#39;. A Problem with signals&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="c"># LOG: successful</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;subscribe, subscribtion correct: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">subscriber_id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;-&gt;(&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">source_id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
            <span class="n">block_name</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span><span class="p">)</span>

        <span class="c"># update meta data of subscriber and source plugin, since the relation between those two changed due to this method.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_meta_data_to_gui</span><span class="p">(</span><span class="n">subscriber_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_meta_data_to_gui</span><span class="p">(</span><span class="n">source_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ERROR</span><span class="o">.</span><span class="n">NO_ERROR</span>
</div>
<div class="viewcode-block" id="Core.check_events_in_delayed_queue"><a class="viewcode-back" href="../../papi.html#papi.core.Core.check_events_in_delayed_queue">[docs]</a>    <span class="k">def</span> <span class="nf">check_events_in_delayed_queue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process all events which are in the delayed operation queue by poping them out and inserting them to the main</span>
<span class="sd">        core event queue &#39;core_event_queue&#39;</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">core_delayed_operation_queue</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">core_event_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">core_delayed_operation_queue</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>


    <span class="c"># ------- Event processing initial stage ---------</span></div>
<div class="viewcode-block" id="Core.__process_event__"><a class="viewcode-back" href="../../papi.html#papi.core.Core.__process_event__">[docs]</a>    <span class="k">def</span> <span class="nf">__process_event__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initial stage of event processing, dividing by event type</span>
<span class="sd">        Extracts event type and give it to a switch case equivalent</span>

<span class="sd">        :param event: event to process</span>
<span class="sd">        :type event: PapiEventBase</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get_eventtype</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__process_event_by_type__</span><span class="p">[</span><span class="n">t</span><span class="p">](</span><span class="n">event</span><span class="p">)</span>

    <span class="c"># ------- Event processing first stage ---------</span></div>
<div class="viewcode-block" id="Core.__process_status_event__"><a class="viewcode-back" href="../../papi.html#papi.core.Core.__process_status_event__">[docs]</a>    <span class="k">def</span> <span class="nf">__process_status_event__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        First stage of event processing, deciding which status_event this is. Therefore, the method extracts the event</span>
<span class="sd">        operation and processes it.</span>

<span class="sd">        :param event: event to process</span>
<span class="sd">        :type event: PapiEventBase</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">op</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get_event_operation</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_status_event_l__</span><span class="p">[</span><span class="n">op</span><span class="p">](</span><span class="n">event</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Core.__process_data_event__"><a class="viewcode-back" href="../../papi.html#papi.core.Core.__process_data_event__">[docs]</a>    <span class="k">def</span> <span class="nf">__process_data_event__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        First stage of event processing, deciding which data_event this is</span>

<span class="sd">        :param event: event to process</span>
<span class="sd">        :type event: PapiEventBase</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">op</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get_event_operation</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_data_event_l__</span><span class="p">[</span><span class="n">op</span><span class="p">](</span><span class="n">event</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Core.__process_instr_event__"><a class="viewcode-back" href="../../papi.html#papi.core.Core.__process_instr_event__">[docs]</a>    <span class="k">def</span> <span class="nf">__process_instr_event__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        First stage of event processing, deciding which instr_event this is. Therefore, the method extracts the event</span>
<span class="sd">        operation and processes it.</span>

<span class="sd">        :param event: event to process</span>
<span class="sd">        :type event: PapiEventBase</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">op</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get_event_operation</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_instr_event_l__</span><span class="p">[</span><span class="n">op</span><span class="p">](</span><span class="n">event</span><span class="p">)</span>

    <span class="c"># ------- Event processing second stage: status events ---------</span></div>
<div class="viewcode-block" id="Core.__process_start_successfull__"><a class="viewcode-back" href="../../papi.html#papi.core.Core.__process_start_successfull__">[docs]</a>    <span class="k">def</span> <span class="nf">__process_start_successfull__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process start_successful event.</span>

<span class="sd">        A start_successful event is sent by plugins after their initialize function returned &#39;true&#39; indicating a</span>
<span class="sd">        successful start of the plugin before continuing with its main execution routine.</span>


<span class="sd">        :param event: event to process</span>
<span class="sd">        :type event: PapiEventBase</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># get plugin from DCore with id of event origin and check if it exists</span>
        <span class="n">dplug</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">get_dplugin_by_id</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">get_originID</span><span class="p">())</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dplug</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">):</span>
            <span class="c"># plugin exists and sent successfull event, so change it state</span>
            <span class="n">dplug</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">PLUGIN_STATE_START_SUCCESFUL</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_meta_data_to_gui</span><span class="p">(</span><span class="n">dplug</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

            <span class="c"># process delayed_operation_queue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_events_in_delayed_queue</span><span class="p">()</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># plugin does not exist</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;start_successfull_event, Event with id &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                <span class="n">event</span><span class="o">.</span><span class="n">get_originID</span><span class="p">())</span> <span class="o">+</span> <span class="s">&#39; but plugin does not exist&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</div>
<div class="viewcode-block" id="Core.__process_start_failed__"><a class="viewcode-back" href="../../papi.html#papi.core.Core.__process_start_failed__">[docs]</a>    <span class="k">def</span> <span class="nf">__process_start_failed__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process start failed event and do error handling</span>

<span class="sd">        This event occurs when a plugin returns false in its initialize routine. Therefore, it means that the start of</span>
<span class="sd">        failed but the plugin noticed it itself and was able to return false.</span>

<span class="sd">        This method will update the core database with the new state of the plugin. At the moment, no other actions are</span>
<span class="sd">        done.</span>

<span class="sd">        :param event: event to process</span>
<span class="sd">        :type event: PapiEventBase</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># get plugin from DCore with id of event origin and check if it exists</span>
        <span class="n">dplug</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">get_dplugin_by_id</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">get_originID</span><span class="p">())</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dplug</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">):</span>
            <span class="c"># plugin exists but start failed, so change its state</span>
            <span class="n">dplug</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">PLUGIN_STATE_START_FAILED</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># plugin does not exist in DCore</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;start_failed_event, Event with id &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                <span class="n">event</span><span class="o">.</span><span class="n">get_originID</span><span class="p">())</span> <span class="o">+</span> <span class="s">&#39; but plugin does not exist&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</div>
<div class="viewcode-block" id="Core.__process_alive__"><a class="viewcode-back" href="../../papi.html#papi.core.Core.__process_alive__">[docs]</a>    <span class="k">def</span> <span class="nf">__process_alive__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Processes alive response from processes/plugins and GUI, organising the counter,</span>
<span class="sd">        i.e. increment GUI counter if alive event&#39;s origin is GUI, otherwise increment counter stored in dplugin object</span>

<span class="sd">        Alive events that were sent by plugins are the response on alive request which were sent by the core alive timer.</span>
<span class="sd">        An alive event indicates that the plugin is still running and responding to requests.</span>

<span class="sd">        :param event: event to process</span>
<span class="sd">        :type event: PapiEventBase</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># get the event origin</span>
        <span class="n">oID</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get_originID</span><span class="p">()</span>
        <span class="c"># check if its the gui</span>
        <span class="k">if</span> <span class="n">oID</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui_id</span><span class="p">:</span>
            <span class="c"># increment GUI counter</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gui_alive_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gui_alive_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui_alive_count</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">alive_count_max</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># its not the Gui, so search for plugin in DCore</span>
            <span class="n">dplug</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">get_dplugin_by_id</span><span class="p">(</span><span class="n">oID</span><span class="p">)</span>
            <span class="c"># check if plugin exists. If plugin exists, increment its counter</span>
            <span class="k">if</span> <span class="n">dplug</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">dplug</span><span class="o">.</span><span class="n">alive_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">dplug</span><span class="o">.</span><span class="n">alive_count</span> <span class="o">=</span> <span class="n">dplug</span><span class="o">.</span><span class="n">alive_count</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">alive_count_max</span>
        <span class="k">return</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="Core.__process_join_request__"><a class="viewcode-back" href="../../papi.html#papi.core.Core.__process_join_request__">[docs]</a>    <span class="k">def</span> <span class="nf">__process_join_request__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process join requests of processes</span>

<span class="sd">        A join request is send from a plugin which will close itself. The requests wants the core to join the process of</span>
<span class="sd">        the plugin for clean-up reasons. Therefore, the join request is just send by plugins running in an own process</span>
<span class="sd">        (and not in the GUI).</span>

<span class="sd">        The method is searching for the dplugin object in the core database to get the corresponding process object.</span>
<span class="sd">        Then, the method joins the process. Note, that a join request is the last action of a plugin to ensure that the</span>
<span class="sd">        core is not blocked by the process join procedure.</span>
<span class="sd">        Afterwards, the plugin will be removed from the core&#39;s database. A event is send to the GUI process to inform the</span>
<span class="sd">        GUI about the closed and removed plugin.</span>

<span class="sd">        :param event: event to process</span>
<span class="sd">        :type event: PapiEventBase</span>
<span class="sd">        :type dplugin: DPlugin</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># get event origin id and its corresponding plugin object</span>
        <span class="n">pl_id</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get_originID</span><span class="p">()</span>
        <span class="n">dplugin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">get_dplugin_by_id</span><span class="p">(</span><span class="n">pl_id</span><span class="p">)</span>
        <span class="c"># check for existence</span>
        <span class="k">if</span> <span class="n">dplugin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># get process of plugin and join it (is blocking but plugin call order ensures that no block can occur)</span>
            <span class="n">dplugin</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
            <span class="c"># remove plugin from DCore, because process was joined and thus, the plugin is identified as &#39;closed&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">rm_dplugin</span><span class="p">(</span><span class="n">dplugin</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
                <span class="c"># remove failed</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;join request, remove plugin with id &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">dplugin</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;failed&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># remove from DCore in core successful</span>
                <span class="c"># Check whether the GUI is still alive to ensure that no new events are put into a queue to a non-existing GUI process</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui_alive</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                    <span class="c"># GUI is still alive, so tell GUI, that this plugin was closed</span>
                    <span class="n">opt</span> <span class="o">=</span> <span class="n">DOptionalData</span><span class="p">()</span>
                    <span class="n">opt</span><span class="o">.</span><span class="n">plugin_id</span> <span class="o">=</span> <span class="n">dplugin</span><span class="o">.</span><span class="n">id</span>
                    <span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">PluginClosed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">core_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui_id</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gui_event_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;join_request, plugin with id &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="n">dplugin</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; was joined (uname: &#39;</span> <span class="o">+</span> <span class="n">dplugin</span><span class="o">.</span><span class="n">uname</span> <span class="o">+</span> <span class="s">&#39; )&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ERROR</span><span class="o">.</span><span class="n">NO_ERROR</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Plug does not exist</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;join_request, Event with id &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                <span class="n">event</span><span class="o">.</span><span class="n">get_originID</span><span class="p">())</span> <span class="o">+</span> <span class="s">&#39; but plugin does not exist&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

    <span class="c"># ------- Event processing second stage: data events ---------</span></div>
<div class="viewcode-block" id="Core.__process_new_data__"><a class="viewcode-back" href="../../papi.html#papi.core.Core.__process_new_data__">[docs]</a>    <span class="k">def</span> <span class="nf">__process_new_data__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process new_data event from plugins.</span>
<span class="sd">        Will do the routing: Subscriber/Subscription</span>

<span class="sd">        This method is doing all the magic in PaPI.</span>
<span class="sd">        It routes all data to its target and decides whether subscription are for data or parameters.</span>

<span class="sd">        First, it is checked if the GUI is alive, since no data shall be processed if the GUI is already closed.</span>
<span class="sd">        Then, the dplugin object of the origin of the data event is searched. Then, the block of the new data is searched.</span>
<span class="sd">        With the block object of the origin plugin, the subscriber list can be extracted. Then, for every subscriber of the</span>
<span class="sd">        block (which has new data available), the plugin object is searched. If a subscriber plugin is running (not dead/stopped),</span>
<span class="sd">        the data event is routed to it. For subscriber running in the GUI, just one event is sent with multiple receipts.</span>
<span class="sd">        Data events which represent parameter subscriptions are handles separately.</span>

<span class="sd">        :param event: event to process</span>
<span class="sd">        :type event: PapiEventBase</span>
<span class="sd">        :type tar_plug: DPlugin</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># just proceed with new_data events if GUI is still alive (indicates that program will close)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui_alive</span><span class="p">:</span>
            <span class="c"># get event origin and optional parameter</span>
            <span class="n">oID</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get_originID</span><span class="p">()</span>
            <span class="n">opt</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get_optional_parameter</span><span class="p">()</span>

            <span class="c"># get origin plugin from DCore</span>
            <span class="n">dplug</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">get_dplugin_by_id</span><span class="p">(</span><span class="n">oID</span><span class="p">)</span>
            <span class="c"># check for existence</span>
            <span class="k">if</span> <span class="n">dplug</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c"># get data block of DPlugin with block_name from event</span>
                <span class="n">block</span> <span class="o">=</span> <span class="n">dplug</span><span class="o">.</span><span class="n">get_dblock_by_name</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">block_name</span><span class="p">)</span>
                <span class="c"># check for existence of block with block_name</span>
                <span class="k">if</span> <span class="n">block</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="c"># get subscriber list of block</span>
                    <span class="n">subscriber</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">get_subscribers</span><span class="p">()</span>
                    <span class="c"># id list dummy for event destination id list</span>
                    <span class="n">id_list</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="c"># for all subscriber in subscriber list</span>
                    <span class="k">for</span> <span class="n">sub_id</span> <span class="ow">in</span> <span class="n">subscriber</span><span class="p">:</span>
                        <span class="c"># get plugin with sub_id and check for existence</span>
                        <span class="n">pl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">get_dplugin_by_id</span><span class="p">(</span><span class="n">sub_id</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">pl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">pl</span><span class="o">.</span><span class="n">state</span> <span class="o">!=</span> <span class="n">PLUGIN_STATE_PAUSE</span> <span class="ow">or</span> <span class="n">pl</span><span class="o">.</span><span class="n">state</span> <span class="o">!=</span> <span class="n">PLUGIN_STATE_STOPPED</span><span class="p">:</span>
                                <span class="c"># plugin exists, check whether it is a ViP</span>
                                <span class="k">if</span> <span class="n">pl</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">PLUGIN_VIP_IDENTIFIER</span><span class="p">:</span>
                                    <span class="c"># Because its a ViP, we need a list of destination ID for new_data</span>
                                    <span class="n">id_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="c"># Plugin is not running in GUI, so just 1:1 relation for event and destinations</span>
                                    <span class="n">opt</span><span class="o">.</span><span class="n">parameter_alias</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">get_subscribtions</span><span class="p">()[</span><span class="n">oID</span><span class="p">][</span><span class="n">opt</span><span class="o">.</span><span class="n">block_name</span><span class="p">]</span><span class="o">.</span><span class="n">alias</span>
                                    <span class="n">new_event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">NewData</span><span class="p">(</span><span class="n">oID</span><span class="p">,</span> <span class="p">[</span><span class="n">pl</span><span class="o">.</span><span class="n">id</span><span class="p">],</span> <span class="n">opt</span><span class="p">,</span> <span class="n">source_plugin_uname</span><span class="o">=</span> <span class="n">dplug</span><span class="o">.</span><span class="n">uname</span><span class="p">)</span>
                                    <span class="n">pl</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">new_event</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="c"># plugin is paused</span>
                                <span class="k">pass</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c"># pluign with sub_id does not exist in DCore of core</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;new_data, subscriber plugin with id &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                <span class="n">sub_id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; does not exists&#39;</span><span class="p">)</span>
                            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
                    <span class="c"># check if our list with id is longer than 0, which will indicate that there is at least one ViP</span>
                    <span class="c"># which will need to get this new data event</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">id_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="c"># send new_data event to GUI with id_list of destinations</span>
                        <span class="n">opt</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get_optional_parameter</span><span class="p">()</span>
                        <span class="n">opt</span><span class="o">.</span><span class="n">parameter_alias</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">get_subscribtions</span><span class="p">()[</span><span class="n">oID</span><span class="p">][</span><span class="n">opt</span><span class="o">.</span><span class="n">block_name</span><span class="p">]</span><span class="o">.</span><span class="n">alias</span>
                        <span class="n">new_event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">NewData</span><span class="p">(</span><span class="n">oID</span><span class="p">,</span> <span class="n">id_list</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">source_plugin_uname</span><span class="o">=</span> <span class="n">dplug</span><span class="o">.</span><span class="n">uname</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">gui_event_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">new_event</span><span class="p">)</span>

                    <span class="c"># this event will be a new parameter value for a plugin, so update dcore data</span>
                    <span class="k">if</span> <span class="n">opt</span><span class="o">.</span><span class="n">is_parameter</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">handle_parameter_change</span><span class="p">(</span><span class="n">pl</span><span class="p">,</span> <span class="n">opt</span><span class="o">.</span><span class="n">parameter_alias</span><span class="p">,</span> <span class="n">opt</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">&#39;pl not assigned (Use of pcp parameter which isn</span><span class="se">\&#39;</span><span class="s">t used)&#39;</span><span class="p">)</span>
                    <span class="c"># process new_data seemed correct</span>
                    <span class="k">return</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># block is None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;new_data, block with name &#39;</span> <span class="o">+</span> <span class="n">opt</span><span class="o">.</span><span class="n">block_name</span> <span class="o">+</span> <span class="s">&#39; does not exists&#39;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Plugin of event origin does not exist in DCore of core</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;new_data, Plugin with id  &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">oID</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;  does not exist in DCore&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</div>
    <span class="k">def</span> <span class="nf">__process_edit_dplugin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process edit_dplugin event from gui.</span>

<span class="sd">        TODO: SVEN</span>

<span class="sd">        :param event: event to process</span>
<span class="sd">        :type event: PapiEventBaseBase</span>
<span class="sd">        :type tar_plug: DPlugin</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">eObject</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">editedObject</span>
        <span class="n">cRequest</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">changeRequest</span>

        <span class="n">dID</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get_destinatioID</span><span class="p">()</span>

        <span class="n">pl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">get_dplugin_by_id</span><span class="p">(</span><span class="n">dID</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">pl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pl</span><span class="o">.</span><span class="n">state</span> <span class="o">!=</span> <span class="n">PLUGIN_STATE_START_SUCCESFUL</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">core_delayed_operation_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">&#39;edit_dplugin, event was placed in delayed queue because plugin with name: &#39;</span> <span class="o">+</span>
                                   <span class="n">pl</span><span class="o">.</span><span class="n">uname</span> <span class="o">+</span> <span class="s">&#39; is still starting&#39;</span><span class="p">)</span>

                <span class="k">return</span> <span class="mi">0</span>

            <span class="c"># DBlock of DPlugin should be edited</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">eObject</span><span class="p">,</span> <span class="n">DBlock</span><span class="p">):</span>

                <span class="n">dblock</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">get_dblock_by_name</span><span class="p">(</span><span class="n">eObject</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dblock</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s">&quot;edit&quot;</span> <span class="ow">in</span> <span class="n">cRequest</span><span class="p">:</span>
                        <span class="n">cObject</span> <span class="o">=</span> <span class="n">cRequest</span><span class="p">[</span><span class="s">&quot;edit&quot;</span><span class="p">]</span>

                        <span class="c"># Signal should be modified in DBlock</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cObject</span><span class="p">,</span> <span class="n">DSignal</span><span class="p">):</span>
                            <span class="n">dsignal</span> <span class="o">=</span> <span class="n">dblock</span><span class="o">.</span><span class="n">get_signal_by_uname</span><span class="p">(</span><span class="n">cObject</span><span class="o">.</span><span class="n">uname</span><span class="p">)</span>

                            <span class="n">dsignal</span><span class="o">.</span><span class="n">dname</span> <span class="o">=</span> <span class="n">cObject</span><span class="o">.</span><span class="n">dname</span>

                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span>
                                               <span class="s">&#39;edit_dplugin, Edited Dblock &#39;</span> <span class="o">+</span> <span class="n">dblock</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#39; of DPlugin &#39;</span> <span class="o">+</span> <span class="n">pl</span><span class="o">.</span><span class="n">uname</span> <span class="o">+</span>
                                               <span class="s">&quot; : DSignal &quot;</span> <span class="o">+</span> <span class="n">dsignal</span><span class="o">.</span><span class="n">uname</span> <span class="o">+</span> <span class="s">&quot; to dname -&gt; &quot;</span> <span class="o">+</span> <span class="n">dsignal</span><span class="o">.</span><span class="n">dname</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">update_meta_data_to_gui</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>

<div class="viewcode-block" id="Core.__process_edit_dplugin_by_uname__"><a class="viewcode-back" href="../../papi.html#papi.core.Core.__process_edit_dplugin_by_uname__">[docs]</a>    <span class="k">def</span> <span class="nf">__process_edit_dplugin_by_uname__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function processes edit plugin events and acts like a wrapper for the &#39;__process_edit_dplugin&#39; function which</span>
<span class="sd">        requires plugin ids instead of unames.</span>

<span class="sd">        Documentation of what the method does can be found in the method: __process_edit_dplugin</span>

<span class="sd">        :param event:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Get dplugin object by uname out of core queue.</span>
        <span class="n">dplugin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">get_dplugin_by_uname</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">plugin_uname</span><span class="p">)</span>
        <span class="c"># Check if plugin object exists</span>
        <span class="k">if</span> <span class="n">dplugin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">pl_id</span> <span class="o">=</span> <span class="n">dplugin</span><span class="o">.</span><span class="n">id</span>
            <span class="c"># create a new event with the corresponding id instead of the uname</span>
            <span class="n">idEvent</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">EditDPlugin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gui_id</span><span class="p">,</span> <span class="n">pl_id</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">editedObject</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">changeRequest</span><span class="p">)</span>
            <span class="c"># pass the event to the function which is wrapped here</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__process_edit_dplugin</span><span class="p">(</span><span class="n">idEvent</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot; Do edit plugin with uname &quot;</span> <span class="o">+</span> <span class="n">event</span><span class="o">.</span><span class="n">plugin_uname</span> <span class="o">+</span> <span class="s">&#39; failed&#39;</span><span class="p">)</span>

    <span class="c"># ------- Event processing second stage: instr events ---------</span></div>
<div class="viewcode-block" id="Core.__process_create_plugin__"><a class="viewcode-back" href="../../papi.html#papi.core.Core.__process_create_plugin__">[docs]</a>    <span class="k">def</span> <span class="nf">__process_create_plugin__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Processes create_plugin event.</span>
<span class="sd">        So it will create a plugin, start a process if needed, send events to GUI to create a plugin and do the pre configuration</span>

<span class="sd">        This method reacts to the create plugin event. Such an event, is mostly sent by the GUI.</span>

<span class="sd">        The method extracts all the necessary plugin properties from the event.</span>
<span class="sd">        Then, the yapsy plugin loader tries to find the plugin via its identifier. Afterwards, the PaPI dplugin object</span>
<span class="sd">        is created and filled with all information. It is decided if the plugin runs in the GUI or in an own process.</span>
<span class="sd">        Based on this, a new process is created or the plugin is redirected to the GUI process.</span>
<span class="sd">        The startup configurations are merged and passed to the plugin.</span>

<span class="sd">        :param event: event to process</span>
<span class="sd">        :param optData: optional Data Object of event</span>
<span class="sd">        :type event: PapiEventBase</span>
<span class="sd">        :type optData: DOptionalData</span>
<span class="sd">        :return: -1: Error</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># get optData to get information about which plugin to start</span>
        <span class="n">optData</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get_optional_parameter</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
                           <span class="s">&#39;create_plugin, Try to create plugin with Name  &#39;</span> <span class="o">+</span> <span class="n">optData</span><span class="o">.</span><span class="n">plugin_identifier</span>
                           <span class="o">+</span> <span class="s">&quot; and UName &quot;</span> <span class="o">+</span> <span class="n">optData</span><span class="o">.</span><span class="n">plugin_uname</span><span class="p">)</span>

        <span class="c"># search yapsy plugin object with plugin_idientifier and check if it exists</span>
        <span class="n">plugin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugin_manager</span><span class="o">.</span><span class="n">getPluginByName</span><span class="p">(</span><span class="n">optData</span><span class="o">.</span><span class="n">plugin_identifier</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plugin</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># Plugin does not exist in yapsy manger, maybe it is new</span>
            <span class="c"># collect plugin information from file system again and recheck</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plugin_manager</span><span class="o">.</span><span class="n">collectPlugins</span><span class="p">()</span>
            <span class="n">plugin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugin_manager</span><span class="o">.</span><span class="n">getPluginByName</span><span class="p">(</span><span class="n">optData</span><span class="o">.</span><span class="n">plugin_identifier</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">plugin</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                                   <span class="s">&#39;create_plugin, Plugin with Name  &#39;</span> <span class="o">+</span> <span class="n">optData</span><span class="o">.</span><span class="n">plugin_identifier</span>
                                   <span class="o">+</span> <span class="s">&#39; does not exist in file system&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

        <span class="c"># creates a new plugin id because plugin exsits</span>
        <span class="n">plugin_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">create_id</span><span class="p">()</span>

        <span class="c"># checks if plugin is of not of type ViP, because these two will run in GUI process</span>
        <span class="k">if</span> <span class="n">plugin</span><span class="o">.</span><span class="n">plugin_object</span><span class="o">.</span><span class="n">_get_type</span><span class="p">()</span> <span class="o">!=</span> <span class="n">PLUGIN_VIP_IDENTIFIER</span><span class="p">:</span>
            <span class="c"># So plugin will not run in GUI</span>
            <span class="c"># it will need an own process and queue to function</span>

            <span class="c"># create Queue for plugin process</span>
            <span class="n">plugin_queue</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">()</span>

            <span class="c"># decide if plugin will need to get Data from another plugin</span>
            <span class="k">if</span> <span class="n">plugin</span><span class="o">.</span><span class="n">plugin_object</span><span class="o">.</span><span class="n">_get_type</span><span class="p">()</span> <span class="o">==</span> <span class="n">PLUGIN_DPP_IDENTIFIER</span><span class="p">:</span>
                <span class="c"># plugin will get data from another, so make its execution triggered by events</span>
                <span class="n">eventTriggered</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># stand alone plugin, so it will do its permanent execute loop</span>
                <span class="n">eventTriggered</span> <span class="o">=</span> <span class="bp">False</span>

            <span class="n">plugin_config</span> <span class="o">=</span> <span class="n">optData</span><span class="o">.</span><span class="n">plugin_config</span>

            <span class="k">if</span> <span class="n">plugin_config</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">plugin_config</span> <span class="o">==</span> <span class="p">{}:</span>
                <span class="n">plugin_config</span> <span class="o">=</span> <span class="n">plugin</span><span class="o">.</span><span class="n">plugin_object</span><span class="o">.</span><span class="n">_get_startup_configuration</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plugin_config</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">plugin</span><span class="o">.</span><span class="n">plugin_object</span><span class="o">.</span><span class="n">_get_startup_configuration</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">())</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="n">plugin_config</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>


            <span class="c"># create Process object for new plugin</span>
            <span class="c"># set parameter for work function of plugin, such as queues, id and eventTriggered</span>
            <span class="n">PluginProcess</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">plugin</span><span class="o">.</span><span class="n">plugin_object</span><span class="o">.</span><span class="n">_work_process</span><span class="p">,</span> \
                                    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">core_event_queue</span><span class="p">,</span> <span class="n">plugin_queue</span><span class="p">,</span> <span class="n">plugin_id</span><span class="p">,</span> <span class="n">eventTriggered</span><span class="p">,</span> \
                                          <span class="n">plugin_config</span><span class="p">,</span> <span class="n">optData</span><span class="o">.</span><span class="n">autostart</span><span class="p">))</span>
            <span class="n">PluginProcess</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

            <span class="c">#Add new Plugin process to DCore</span>
            <span class="n">dplug</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">add_plugin</span><span class="p">(</span><span class="n">PluginProcess</span><span class="p">,</span> <span class="n">PluginProcess</span><span class="o">.</span><span class="n">pid</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">plugin_queue</span><span class="p">,</span> <span class="n">plugin</span><span class="p">,</span> <span class="n">plugin_id</span><span class="p">)</span>
            <span class="n">dplug</span><span class="o">.</span><span class="n">plugin_identifier</span> <span class="o">=</span> <span class="n">plugin</span><span class="o">.</span><span class="n">name</span>
            <span class="n">dplug</span><span class="o">.</span><span class="n">uname</span> <span class="o">=</span> <span class="n">optData</span><span class="o">.</span><span class="n">plugin_uname</span>
            <span class="n">dplug</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">plugin</span><span class="o">.</span><span class="n">plugin_object</span><span class="o">.</span><span class="n">_get_type</span><span class="p">()</span>
            <span class="n">dplug</span><span class="o">.</span><span class="n">alive_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alive_count</span>
            <span class="n">dplug</span><span class="o">.</span><span class="n">startup_config</span> <span class="o">=</span> <span class="n">plugin_config</span>
            <span class="n">dplug</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">plugin</span><span class="o">.</span><span class="n">path</span>

            <span class="c"># change some attributes of optional data before sending it back to GUI for local creation</span>
            <span class="n">optData</span><span class="o">.</span><span class="n">plugin_identifier</span> <span class="o">=</span> <span class="n">plugin</span><span class="o">.</span><span class="n">name</span>
            <span class="n">optData</span><span class="o">.</span><span class="n">plugin_id</span> <span class="o">=</span> <span class="n">plugin_id</span>
            <span class="n">optData</span><span class="o">.</span><span class="n">plugin_type</span> <span class="o">=</span> <span class="n">dplug</span><span class="o">.</span><span class="n">type</span>

            <span class="c"># send create_plugin event to GUI for local creation, now with new information like id and type</span>
            <span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">instruction</span><span class="o">.</span><span class="n">CreatePlugin</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui_id</span><span class="p">,</span> <span class="n">optData</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gui_event_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Plugin will run in GUI, thats why core does not need to create a new process</span>

            <span class="c"># Adding plugin information to DCore of core for organisation</span>
            <span class="n">dplug</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">add_plugin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gui_process</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui_process</span><span class="o">.</span><span class="n">pid</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui_event_queue</span><span class="p">,</span>
                                              <span class="n">plugin</span><span class="p">,</span> <span class="n">plugin_id</span><span class="p">)</span>
            <span class="n">dplug</span><span class="o">.</span><span class="n">uname</span> <span class="o">=</span> <span class="n">optData</span><span class="o">.</span><span class="n">plugin_uname</span>
            <span class="n">dplug</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">plugin</span><span class="o">.</span><span class="n">plugin_object</span><span class="o">.</span><span class="n">_get_type</span><span class="p">()</span>
            <span class="n">dplug</span><span class="o">.</span><span class="n">plugin_identifier</span> <span class="o">=</span> <span class="n">plugin</span><span class="o">.</span><span class="n">name</span>
            <span class="n">dplug</span><span class="o">.</span><span class="n">startup_config</span> <span class="o">=</span> <span class="n">optData</span><span class="o">.</span><span class="n">plugin_config</span>
            <span class="n">dplug</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">plugin</span><span class="o">.</span><span class="n">path</span>

            <span class="c"># change some attributes of optional data before sending it back to GUI for local creation</span>
            <span class="n">optData</span><span class="o">.</span><span class="n">plugin_identifier</span> <span class="o">=</span> <span class="n">plugin</span><span class="o">.</span><span class="n">name</span>
            <span class="n">optData</span><span class="o">.</span><span class="n">plugin_id</span> <span class="o">=</span> <span class="n">plugin_id</span>
            <span class="n">optData</span><span class="o">.</span><span class="n">plugin_type</span> <span class="o">=</span> <span class="n">dplug</span><span class="o">.</span><span class="n">type</span>

            <span class="c"># send create_plugin event to GUI for local creation, now with new information like id and type</span>
            <span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">instruction</span><span class="o">.</span><span class="n">CreatePlugin</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui_id</span><span class="p">,</span> <span class="n">optData</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gui_event_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">&#39;core sent create event to gui for plugin: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">optData</span><span class="o">.</span><span class="n">plugin_uname</span><span class="p">))</span>
            <span class="k">return</span> <span class="mi">1</span>
</div>
<div class="viewcode-block" id="Core.__process_stop_plugin__"><a class="viewcode-back" href="../../papi.html#papi.core.Core.__process_stop_plugin__">[docs]</a>    <span class="k">def</span> <span class="nf">__process_stop_plugin__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process stop_plugin event.</span>
<span class="sd">        Will send an event to destination plugin to close itself. Will lead to a join request of this plugin.</span>

<span class="sd">        A stop plugin event is sent by the GUI to the core to request the core to stop a plugin.</span>
<span class="sd">        &#39;Stop&#39; means that: either the plugin is just stopped and not deleted or the plugin execution is stopped and the</span>
<span class="sd">        is deleted from the database (i.e. it is cleaned). It is determines by a flag which of them is used.</span>

<span class="sd">        The methods searches for the dplugin object in the core database.</span>
<span class="sd">        If the plugin runs in an own process, the stop event is redirected to the corresponding plugin</span>
<span class="sd">        (to notify it to close itself). The core will cut all subscriptions&amp;subscribers loose and update the gui data with</span>
<span class="sd">        the new plugin state.</span>
<span class="sd">        If the plugin is not running in an own process (runs in GUI), the event is checked for the delete flag.</span>
<span class="sd">        If the delete flag is set, the method will send a close request to the plugin.</span>
<span class="sd">        If not, the plugin will receive a customized stop event. The state will be modified and updated to the GUI.</span>

<span class="sd">        :param event: event to process</span>
<span class="sd">        :type event: PapiEventBase</span>
<span class="sd">        :type dplugin: DPlugin</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># get destination id</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get_destinatioID</span><span class="p">()</span>

        <span class="c"># get DPlugin object and check if plugin exists</span>
        <span class="n">dplugin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">get_dplugin_by_id</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dplugin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># dplugin exist, get queue and route event to plugin</span>
            <span class="k">if</span> <span class="n">dplugin</span><span class="o">.</span><span class="n">own_process</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                <span class="c"># dplugin is not running in gui</span>
                <span class="c"># tell plugin to stop and update state and GUI</span>
                <span class="n">dplugin</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
                <span class="n">dplugin</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">PLUGIN_STATE_STOPPED</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">unsubscribe_all</span><span class="p">(</span><span class="n">dplugin</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">rm_all_subscribers</span><span class="p">(</span><span class="n">dplugin</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_meta_data_to_gui_for_all</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># plugin is not running in own process, so process the event completely</span>
                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">delete</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                    <span class="c"># tell gui to close plugin</span>
                    <span class="n">opt</span> <span class="o">=</span> <span class="n">DOptionalData</span><span class="p">()</span>
                    <span class="n">opt</span><span class="o">.</span><span class="n">plugin_id</span> <span class="o">=</span> <span class="nb">id</span>
                    <span class="n">dplugin</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">Event</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">PluginClosed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">core_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui_id</span><span class="p">,</span> <span class="n">opt</span><span class="p">))</span>

                    <span class="c"># remove plugin from DCore</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">rm_dplugin</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">!=</span> <span class="n">ERROR</span><span class="o">.</span><span class="n">NO_ERROR</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;stop plugin, unable to remove plugin von core_data&#39;</span><span class="p">)</span>
                        <span class="k">return</span> <span class="n">ERROR</span><span class="o">.</span><span class="n">UNKNOWN_ERROR</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># Do not delete the plugin from the database, thus just send a stop event to plugin without delete flag.</span>
                    <span class="n">dplugin</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">Event</span><span class="o">.</span><span class="n">instruction</span><span class="o">.</span><span class="n">StopPlugin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">core_id</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>
                    <span class="c"># update plugin state and gui meta database</span>
                    <span class="n">dplugin</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">PLUGIN_STATE_STOPPED</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">unsubscribe_all</span><span class="p">(</span><span class="n">dplugin</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">rm_all_subscribers</span><span class="p">(</span><span class="n">dplugin</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">update_meta_data_to_gui_for_all</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">ERROR</span><span class="o">.</span><span class="n">NO_ERROR</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># DPlugin does not exist</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;stop_plugin, plugin with id &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; not found&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ERROR</span><span class="o">.</span><span class="n">UNKNOWN_ERROR</span>
</div>
<div class="viewcode-block" id="Core.__process_stop_plugin_by_uname__"><a class="viewcode-back" href="../../papi.html#papi.core.Core.__process_stop_plugin_by_uname__">[docs]</a>    <span class="k">def</span> <span class="nf">__process_stop_plugin_by_uname__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Just a wrapper function for &#39;__process_stop_plugin__&#39; to use the uname instead of a plugin id.</span>

<span class="sd">        :param event:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">dplugin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">get_dplugin_by_uname</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">plugin_uname</span><span class="p">)</span>
        <span class="c"># check  if plugin exists in core database</span>
        <span class="k">if</span> <span class="n">dplugin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># get plugin id, rebuild event and call original function</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="n">dplugin</span><span class="o">.</span><span class="n">id</span>
            <span class="n">idEvent</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">instruction</span><span class="o">.</span><span class="n">StopPlugin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gui_id</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__process_stop_plugin__</span><span class="p">(</span><span class="n">idEvent</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Core.__process_start_plugin__"><a class="viewcode-back" href="../../papi.html#papi.core.Core.__process_start_plugin__">[docs]</a>    <span class="k">def</span> <span class="nf">__process_start_plugin__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Processes start event for a plugin.</span>

<span class="sd">        The start plugin event is a request for the core to send a start event to a plugin.</span>
<span class="sd">        The plugin will be started by receiving the event, i.e. it will call its initialize function and start its</span>
<span class="sd">        execution afterwards.</span>

<span class="sd">        The methods searches the plugin in the database and checks wheter it has its own process or not.</span>
<span class="sd">        Then, it will send an event to the corresponding queue to tell the plugin it should start.</span>

<span class="sd">        :param event: Incomming event</span>
<span class="sd">        :type event:  PapiEventBase</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># get destination id</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get_destinatioID</span><span class="p">()</span>
        <span class="c"># get DPlugin object and check if plugin exists</span>
        <span class="n">dplugin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">get_dplugin_by_id</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dplugin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># dplugin exist, get queue and route event to plugin</span>
            <span class="k">if</span> <span class="n">dplugin</span><span class="o">.</span><span class="n">own_process</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                <span class="c"># dplugin is not running in gui</span>
                <span class="c"># tell plugin to quit</span>
                <span class="n">dplugin</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dplugin</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">PLUGIN_STATE_START_SUCCESFUL</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gui_event_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_meta_data_to_gui</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Core.__process_plugin_stopped__"><a class="viewcode-back" href="../../papi.html#papi.core.Core.__process_plugin_stopped__">[docs]</a>    <span class="k">def</span> <span class="nf">__process_plugin_stopped__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process plugin_stopped event.</span>
<span class="sd">        Will change plugins state and delete its parameters and blocks.</span>
<span class="sd">        Will update meta to gui</span>

<span class="sd">        The event is the result of a stop request of a plugin. A plugin which is request to stop its operation (no deletion)</span>
<span class="sd">        sends the plugin stopped event to confirm that it has stopped its operation.</span>

<span class="sd">        The method searches the plugin in the database and updates its state. Additionally, all subscribers, blocks and</span>
<span class="sd">        parameter are removed/delete.</span>

<span class="sd">        :param event: Incomming event</span>
<span class="sd">        :type event:  PapiEventBase</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pl_id</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get_originID</span><span class="p">()</span>
        <span class="n">plugin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">get_dplugin_by_id</span><span class="p">(</span><span class="n">pl_id</span><span class="p">)</span>
        <span class="c"># check if plugin exists</span>
        <span class="k">if</span> <span class="n">plugin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># update state</span>
            <span class="n">plugin</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">PLUGIN_STATE_STOPPED</span>

            <span class="c"># remove all subscribers before removing the blocks</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">rm_all_subscribers</span><span class="p">(</span><span class="n">pl_id</span><span class="p">)</span>

            <span class="c"># delete all blocks of plugin</span>
            <span class="n">blocks</span> <span class="o">=</span> <span class="n">plugin</span><span class="o">.</span><span class="n">get_dblocks</span><span class="p">()</span>
            <span class="n">block_to_delete</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">block_key</span> <span class="ow">in</span> <span class="n">blocks</span><span class="p">:</span>
                <span class="n">block</span> <span class="o">=</span> <span class="n">blocks</span><span class="p">[</span><span class="n">block_key</span><span class="p">]</span>
                <span class="n">block_to_delete</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">block_to_delete</span><span class="p">:</span>
                <span class="n">plugin</span><span class="o">.</span><span class="n">rm_dblock</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

            <span class="c"># delete all parameters of plugin</span>
            <span class="n">paras</span> <span class="o">=</span> <span class="n">plugin</span><span class="o">.</span><span class="n">get_parameters</span><span class="p">()</span>
            <span class="n">paras_to_delete</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">paras</span><span class="p">:</span>
                <span class="n">para</span> <span class="o">=</span> <span class="n">paras</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="n">paras_to_delete</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">paras_to_delete</span><span class="p">:</span>
                <span class="n">plugin</span><span class="o">.</span><span class="n">rm_parameter</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

            <span class="c"># update to gui</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_meta_data_to_gui</span><span class="p">(</span><span class="n">pl_id</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Core.__process_close_programm__"><a class="viewcode-back" href="../../papi.html#papi.core.Core.__process_close_programm__">[docs]</a>    <span class="k">def</span> <span class="nf">__process_close_programm__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This functions processes a close_program event from GUI and</span>
<span class="sd">        sends events to all processes to close themselves</span>

<span class="sd">        The GUI can request the close to quit PaPI.</span>

<span class="sd">        The method will request all other processes to stop their execution and to close.</span>

<span class="sd">        :param event: event to process</span>
<span class="sd">        :type event: PapiEventBase</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># GUI wants to close, so join process</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui_alive</span> <span class="ow">is</span> <span class="bp">True</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_parent</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gui_process</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

        <span class="c"># Set gui_alive to false for core loop to know that is it closed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gui_alive</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="c"># get a list of all running plugIns</span>
        <span class="n">all_plugins</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">get_all_plugins</span><span class="p">()</span>

        <span class="c"># iterate through all plugins to send an event to tell them to quit and</span>
        <span class="c"># response with a join_request</span>
        <span class="n">toDelete</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dplugin_key</span> <span class="ow">in</span> <span class="n">all_plugins</span><span class="p">:</span>
            <span class="n">dplugin</span> <span class="o">=</span> <span class="n">all_plugins</span><span class="p">[</span><span class="n">dplugin_key</span><span class="p">]</span>
            <span class="c"># just send event to plugins running in own process</span>
            <span class="k">if</span> <span class="n">dplugin</span><span class="o">.</span><span class="n">own_process</span><span class="p">:</span>
                <span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">instruction</span><span class="o">.</span><span class="n">StopPlugin</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dplugin</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
                <span class="n">dplugin</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">toDelete</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dplugin</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">dplugin_ID</span> <span class="ow">in</span> <span class="n">toDelete</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">rm_dplugin</span><span class="p">(</span><span class="n">dplugin_ID</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Core.__process_subscribe__"><a class="viewcode-back" href="../../papi.html#papi.core.Core.__process_subscribe__">[docs]</a>    <span class="k">def</span> <span class="nf">__process_subscribe__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process subscribe_event.</span>

<span class="sd">        The event is sent to create new data connections between plugins.</span>

<span class="sd">        The method will call the functional method &#39;new_subscription&#39; will the necessary arguments,</span>
<span class="sd">        like SourceID, Block, Signals, Alias</span>

<span class="sd">        :param event: event to process</span>
<span class="sd">        :type event: PapiEventBase</span>
<span class="sd">        :type dplugin_sub: DPlugin</span>
<span class="sd">        :type dplugin_source: DPlugin</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># get event origin id and optional parameters</span>
        <span class="n">opt</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get_optional_parameter</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_subscription</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">get_originID</span><span class="p">(),</span> <span class="n">opt</span><span class="o">.</span><span class="n">source_ID</span><span class="p">,</span> <span class="n">opt</span><span class="o">.</span><span class="n">block_name</span><span class="p">,</span> <span class="n">opt</span><span class="o">.</span><span class="n">signals</span><span class="p">,</span> <span class="n">opt</span><span class="o">.</span><span class="n">subscription_alias</span><span class="p">,</span>
                              <span class="n">orginal_event</span><span class="o">=</span><span class="n">event</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Core.__process_subscribe_by_uname__"><a class="viewcode-back" href="../../papi.html#papi.core.Core.__process_subscribe_by_uname__">[docs]</a>    <span class="k">def</span> <span class="nf">__process_subscribe_by_uname__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process subscribe_event. Uses uname instead of IDs</span>

<span class="sd">        The event is sent to create new data connections between plugins.</span>

<span class="sd">        The method will call the functional method &#39;new_subscription&#39; will the necessary arguments,</span>
<span class="sd">        like SourceID, Block, Signals, Alias</span>

<span class="sd">        :param event: event to process</span>
<span class="sd">        :type event: PapiEventBase</span>
<span class="sd">        :type dplugin_sub: DPlugin</span>
<span class="sd">        :type dplugin_source: DPlugin</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">get_dplugin_by_uname</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">subscriber_uname</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">subscriber_id</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">id</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># plugin with uname does not exist</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;do_subscribe, sub uname worng&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

        <span class="n">pl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">get_dplugin_by_uname</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">source_uname</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">source_id</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">id</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># plugin with uname does not exist</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;do_subscribe, target uname wrong&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">new_subscription</span><span class="p">(</span><span class="n">subscriber_id</span><span class="p">,</span> <span class="n">source_id</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">block_name</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">signals</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">sub_alias</span><span class="p">,</span>
                              <span class="n">orginal_event</span><span class="o">=</span><span class="n">event</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Core.__process_unsubsribe__"><a class="viewcode-back" href="../../papi.html#papi.core.Core.__process_unsubsribe__">[docs]</a>    <span class="k">def</span> <span class="nf">__process_unsubsribe__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process unsubscribe_event. Will try to remove a subscription from DCore</span>

<span class="sd">        :param event: event to process</span>
<span class="sd">        :type event: PapiEventBase</span>
<span class="sd">        :type dplugin_sub: DPlugin</span>
<span class="sd">        :type dplugin_source: DPlugin</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># get event origin id and optional parameters</span>
        <span class="n">opt</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get_optional_parameter</span><span class="p">()</span>
        <span class="n">oID</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get_originID</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">opt</span><span class="o">.</span><span class="n">signals</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="c"># try to unsubscribe</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">unsubscribe</span><span class="p">(</span><span class="n">oID</span><span class="p">,</span> <span class="n">opt</span><span class="o">.</span><span class="n">source_ID</span><span class="p">,</span> <span class="n">opt</span><span class="o">.</span><span class="n">block_name</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
                <span class="c"># unsubscribe failed</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                                   <span class="s">&#39;unsubscribe, something failed in unsubsription process with subscriber id: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                       <span class="n">oID</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;..target id:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">source_ID</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;..and block &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                       <span class="n">opt</span><span class="o">.</span><span class="n">block_name</span><span class="p">))</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">unsubscribe_signals</span><span class="p">(</span><span class="n">oID</span><span class="p">,</span> <span class="n">opt</span><span class="o">.</span><span class="n">source_ID</span><span class="p">,</span> <span class="n">opt</span><span class="o">.</span><span class="n">block_name</span><span class="p">,</span> <span class="n">opt</span><span class="o">.</span><span class="n">signals</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

        <span class="c"># unsubscribe correct</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                           <span class="s">&#39;unsubscribe, unsubscribtion correct: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">oID</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;-&gt;(&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">source_ID</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                               <span class="n">opt</span><span class="o">.</span><span class="n">block_name</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_meta_data_to_gui</span><span class="p">(</span><span class="n">oID</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_meta_data_to_gui</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">source_ID</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Core.__process_set_parameter__"><a class="viewcode-back" href="../../papi.html#papi.core.Core.__process_set_parameter__">[docs]</a>    <span class="k">def</span> <span class="nf">__process_set_parameter__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process set_parameter event. Core will just route this event from GUI to destination plugin and update DCore</span>

<span class="sd">        The set parameter event is sent from plugins to some plugins to trigger parameter changes.</span>

<span class="sd">        First, the method checks whether the event is an event by uname or by id. When the event is by uname, it is modified</span>
<span class="sd">        to be by id. If the plugin which the event refers to is not started yet, the event is put in the</span>
<span class="sd">        delayed operation queue. Then, the correct dplugin object and an event by id is available. The dplugin object is</span>
<span class="sd">        searched for the parameter which is changed. If the parameter exists, its value in the database is changed and</span>
<span class="sd">        then, the change event is redirected to the plugin itself.</span>

<span class="sd">        :param event: event to process</span>
<span class="sd">        :type event: PapiEventBase</span>
<span class="sd">        :type dplugin_sub: DPlugin</span>
<span class="sd">        :type dplugin_source: DPlugin</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># check if event is by uname or by id</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">Event</span><span class="o">.</span><span class="n">instruction</span><span class="o">.</span><span class="n">SetParameterByUname</span><span class="p">):</span>
            <span class="n">dplugin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">get_dplugin_by_uname</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">plugin_uname</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dplugin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dplugin</span><span class="o">.</span><span class="n">state</span> <span class="o">!=</span> <span class="n">PLUGIN_STATE_START_SUCCESFUL</span><span class="p">:</span>
                    <span class="c"># plugin not here yet, put event in delayed queue</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">core_delayed_operation_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">&#39;setParameterByUname, event was placed in delayed queue because plugin: &#39;</span>
                                       <span class="o">+</span> <span class="n">event</span><span class="o">.</span><span class="n">plugin_uname</span> <span class="o">+</span> <span class="s">&#39; does not exist yet.&#39;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="mi">0</span>
                <span class="c"># build forward event for gui with ids instead of uname (original event was with uname)</span>
                <span class="n">forward_event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">instruction</span><span class="o">.</span><span class="n">SetParameter</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">get_originID</span><span class="p">(),</span> <span class="n">dplugin</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">get_optional_parameter</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Event is by id, so get destination id</span>
            <span class="n">pl_id</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get_destinatioID</span><span class="p">()</span>
            <span class="c"># get DPlugin object of destination id from DCore and check for existence</span>
            <span class="n">dplugin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">get_dplugin_by_id</span><span class="p">(</span><span class="n">pl_id</span><span class="p">)</span>
            <span class="c"># set forward event to event, since there is no change required (event already by id)</span>
            <span class="n">forward_event</span> <span class="o">=</span> <span class="n">event</span>
            <span class="k">if</span> <span class="n">dplugin</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c">#  plugin with id does not exist, so id is wrong.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;set_paramenter, plugin with id &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pl_id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; not found&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

        <span class="c"># Now, the forward_event has the correct event with ids to process it.</span>
        <span class="c"># recheck for existing dplugin</span>
        <span class="k">if</span> <span class="n">dplugin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># Plugin exists</span>
            <span class="c"># get parameter list of plugin [hash]</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="n">dplugin</span><span class="o">.</span><span class="n">get_parameters</span><span class="p">()</span>
            <span class="n">opt</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get_optional_parameter</span><span class="p">()</span>
            <span class="c"># check for existence of the changed parameter</span>
            <span class="k">if</span> <span class="n">opt</span><span class="o">.</span><span class="n">parameter_alias</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
                <span class="n">para</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="n">opt</span><span class="o">.</span><span class="n">parameter_alias</span><span class="p">]</span>
                <span class="n">para</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">data</span>
                <span class="c"># route the event to the destination plugin queue</span>
                <span class="n">dplugin</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">forward_event</span><span class="p">)</span>
                <span class="c"># change event type for plugin</span>
                <span class="c">#update GUI</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_meta_data_to_gui</span><span class="p">(</span><span class="n">dplugin</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="k">return</span> <span class="mi">1</span>
</div>
<div class="viewcode-block" id="Core.__process_new_block__"><a class="viewcode-back" href="../../papi.html#papi.core.Core.__process_new_block__">[docs]</a>    <span class="k">def</span> <span class="nf">__process_new_block__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Processes new_block event.</span>
<span class="sd">        Will try to add a new data block to a DPlugin object</span>

<span class="sd">        This event is a request from a plugin to create a new block.</span>

<span class="sd">        The method receives all block information via the event. It searches the corresponding pluign and add the blocks</span>

<span class="sd">        :param event: event to process</span>
<span class="sd">        :type event: PapiEventBase</span>
<span class="sd">        :type dplugin_sub: DPlugin</span>
<span class="sd">        :type dplugin_source: DPlugin</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># get event origin id and optional parameter</span>
        <span class="n">opt</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get_optional_parameter</span><span class="p">()</span>
        <span class="n">pl_id</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get_originID</span><span class="p">()</span>
        <span class="c"># get DPlugin object with origin id of event to add new parameter to THIS DPlugin</span>
        <span class="n">dplugin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">get_dplugin_by_id</span><span class="p">(</span><span class="n">pl_id</span><span class="p">)</span>
        <span class="c"># check for existence</span>
        <span class="k">if</span> <span class="n">dplugin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># dplugin exists, so add blocks to DPlugin</span>
            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">opt</span><span class="o">.</span><span class="n">block_list</span><span class="p">:</span>
                <span class="n">dplugin</span><span class="o">.</span><span class="n">add_dblock</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
            <span class="c"># update meta information of GUI after new blocks were added</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_meta_data_to_gui</span><span class="p">(</span><span class="n">pl_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_events_in_delayed_queue</span><span class="p">()</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># plugin does not exist</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;new_block, plugin with id &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pl_id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; not found&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</div>
<div class="viewcode-block" id="Core.__process_delete_block__"><a class="viewcode-back" href="../../papi.html#papi.core.Core.__process_delete_block__">[docs]</a>    <span class="k">def</span> <span class="nf">__process_delete_block__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Processes delete_block event.</span>

<span class="sd">        The event is sent by a plugin if the plugin wants to delete one of its own blocks (plugin updates itself).</span>

<span class="sd">        The methods searches in the dplugin object for the block and deletes it. Before deletion, all block</span>
<span class="sd">        subscriptions are cut loose to ensure that no dead links are created.</span>

<span class="sd">        :param event: event to process</span>
<span class="sd">        :type event: PapiEventBase</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pl_id</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get_originID</span><span class="p">()</span>
        <span class="c"># cut loose all subscription for the block</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">rm_all_subscribers_of_a_dblock</span><span class="p">(</span><span class="n">pl_id</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">blockname</span><span class="p">)</span>

        <span class="c"># get plugin object</span>
        <span class="n">plugin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">get_dplugin_by_id</span><span class="p">(</span><span class="n">pl_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plugin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># get block and remove it</span>
            <span class="n">dblock</span> <span class="o">=</span> <span class="n">plugin</span><span class="o">.</span><span class="n">get_dblock_by_name</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">blockname</span><span class="p">)</span>
            <span class="n">plugin</span><span class="o">.</span><span class="n">rm_dblock</span><span class="p">(</span><span class="n">dblock</span><span class="p">)</span>

        <span class="c"># send update to gui to propagate the change</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_meta_data_to_gui_for_all</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Core.__process_delete_parameter__"><a class="viewcode-back" href="../../papi.html#papi.core.Core.__process_delete_parameter__">[docs]</a>    <span class="k">def</span> <span class="nf">__process_delete_parameter__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Processes delete parameter event.</span>

<span class="sd">        The event is sent by a plugin if the plugin wants to delete one of its own parameter (plugin updates itself).</span>

<span class="sd">        The methods searches in the dplugin object for the parameter and deletes it. Before deletion, all parameter</span>
<span class="sd">        subscriptions are cut loose to ensure that no dead links are created.</span>

<span class="sd">        :param event: event to process</span>
<span class="sd">        :type event: PapiEventBase</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Get id of plugin which parameter should be changed</span>
        <span class="n">pl_id</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get_originID</span><span class="p">()</span>
        <span class="c"># Search in database for plugin object</span>
        <span class="n">dplugin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">get_dplugin_by_id</span><span class="p">(</span><span class="n">pl_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dplugin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># get connections of this dplugin (copy because changes in iteration are possible)</span>
            <span class="n">subscriptions</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">dplugin</span><span class="o">.</span><span class="n">get_subscribtions</span><span class="p">())</span>
            <span class="c"># iterate over all source plugins by id in subscription dict</span>
            <span class="k">for</span> <span class="n">source_id</span> <span class="ow">in</span> <span class="n">subscriptions</span><span class="p">:</span>
                <span class="c"># iterate over all blocks</span>
                <span class="k">for</span> <span class="n">blockName</span> <span class="ow">in</span> <span class="n">subscriptions</span><span class="p">[</span><span class="n">source_id</span><span class="p">]:</span>
                    <span class="n">dSubObject</span> <span class="o">=</span> <span class="n">subscriptions</span><span class="p">[</span><span class="n">source_id</span><span class="p">][</span><span class="n">blockName</span><span class="p">]</span>
                    <span class="c"># search for parameter to delete in subscription</span>
                    <span class="k">if</span> <span class="n">dSubObject</span><span class="o">.</span><span class="n">alias</span> <span class="o">==</span> <span class="n">event</span><span class="o">.</span><span class="n">parameterName</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">unsubscribe</span><span class="p">(</span><span class="n">pl_id</span><span class="p">,</span> <span class="n">source_id</span><span class="p">,</span> <span class="n">blockName</span><span class="p">)</span>

            <span class="c"># delete parameter in dplugin</span>
            <span class="n">paraObject</span> <span class="o">=</span> <span class="n">dplugin</span><span class="o">.</span><span class="n">get_parameters</span><span class="p">()[</span><span class="n">event</span><span class="o">.</span><span class="n">parameterName</span><span class="p">]</span>
            <span class="n">dplugin</span><span class="o">.</span><span class="n">rm_parameter</span><span class="p">(</span><span class="n">paraObject</span><span class="p">)</span>

            <span class="c"># send update to gui to propagate the change</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_meta_data_to_gui_for_all</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Core.__process_new_parameter__"><a class="viewcode-back" href="../../papi.html#papi.core.Core.__process_new_parameter__">[docs]</a>    <span class="k">def</span> <span class="nf">__process_new_parameter__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Processes new parameter event. Adding a new parameter to DPluign in DCore and updating GUI information</span>

<span class="sd">        :param event: event to process</span>
<span class="sd">        :type event: PapiEventBase</span>
<span class="sd">        :type dplugin_sub: DPlugin</span>
<span class="sd">        :type dplugin_source: DPlugin</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># get event origin and optional parameter</span>
        <span class="n">opt</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get_optional_parameter</span><span class="p">()</span>
        <span class="n">pl_id</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get_originID</span><span class="p">()</span>

        <span class="c"># get DPlugin object of event origin id which is the plugin that wants to add parameter</span>
        <span class="n">dplugin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">get_dplugin_by_id</span><span class="p">(</span><span class="n">pl_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dplugin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># Plugin exists so loop through parameter list to add all parameter</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">opt</span><span class="o">.</span><span class="n">parameter_list</span><span class="p">:</span>
                <span class="c"># add parameter to DPlugin</span>
                <span class="n">dplugin</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="c"># update meta of GUI to introduce new parameter to user</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_meta_data_to_gui</span><span class="p">(</span><span class="n">pl_id</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># plugin does not exist</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">printText</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;new_parameter, plugin with id &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pl_id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; not found&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</div>
<div class="viewcode-block" id="Core.__process_pause_plugin__"><a class="viewcode-back" href="../../papi.html#papi.core.Core.__process_pause_plugin__">[docs]</a>    <span class="k">def</span> <span class="nf">__process_pause_plugin__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Processes pause_plugin event. Will add information that a plugin is paused and send event to plugin to pause it.</span>

<span class="sd">        Pause events are request from the GUI to pause a plugin. Paused plugins will not execute its execution function and</span>
<span class="sd">        thus, lower the computational load.</span>

<span class="sd">        :param event: event to process</span>
<span class="sd">        :type event: PapiEventBase</span>
<span class="sd">        :type dplugin: DPlugin</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pl_id</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get_destinatioID</span><span class="p">()</span>

        <span class="n">dplugin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">get_dplugin_by_id</span><span class="p">(</span><span class="n">pl_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dplugin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dplugin</span><span class="o">.</span><span class="n">state</span> <span class="o">!=</span> <span class="n">PLUGIN_STATE_PAUSE</span><span class="p">:</span>
                <span class="c"># set pause info</span>
                <span class="n">dplugin</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">PLUGIN_STATE_PAUSE</span>
                <span class="c"># send event to plugin</span>
                <span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">instruction</span><span class="o">.</span><span class="n">PausePlugin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">core_id</span><span class="p">,</span> <span class="n">pl_id</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
                <span class="n">dplugin</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

                <span class="c"># update meta for Gui</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_meta_data_to_gui</span><span class="p">(</span><span class="n">pl_id</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Core.__process_resume_plugin__"><a class="viewcode-back" href="../../papi.html#papi.core.Core.__process_resume_plugin__">[docs]</a>    <span class="k">def</span> <span class="nf">__process_resume_plugin__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Processes resume_plugin event. Will add information that a plugin is resumed and send event to plugin to resume it.</span>

<span class="sd">        Resumes a paused plugin to make it work again. So, the plugin will execute its main functions again.</span>

<span class="sd">        :param event: event to process</span>
<span class="sd">        :type event: PapiEventBase</span>
<span class="sd">        :type dplugin: DPlugin</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pl_id</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get_destinatioID</span><span class="p">()</span>

        <span class="n">dplugin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core_data</span><span class="o">.</span><span class="n">get_dplugin_by_id</span><span class="p">(</span><span class="n">pl_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dplugin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dplugin</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">PLUGIN_STATE_PAUSE</span><span class="p">:</span>
                <span class="c"># set resume info</span>
                <span class="n">dplugin</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">PLUGIN_STATE_RESUMED</span>
                <span class="c"># send event to plugin</span>
                <span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">instruction</span><span class="o">.</span><span class="n">ResumePlugin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">core_id</span><span class="p">,</span> <span class="n">pl_id</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
                <span class="n">dplugin</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

                <span class="c"># update meta for Gui</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_meta_data_to_gui</span><span class="p">(</span><span class="n">pl_id</span><span class="p">)</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
	<h3> Links </h3>
	<ul> 
	  <li>
	    <a href="../../CHANGELOG.html">Changelog</a> </li>
	  </li>
	  <li>
	    <a href="../../toc.manual.html">Manual</a> </li>
	  </li>
	  <li>
	    <a href="../../toc.framework.html">Framework</a> </li>
	  </li>
	  <li>
	    <a href="../../man.papi.plugin.doc.html">Plugins</a> </li>
	  </li>
	</ul>
	

<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
    
        <li><a href="../../index.html">papi v.1.4 documentation</a> &raquo;</li>
    <li><a href="https://github.com/TUB-Control/PaPI">GitHub</a> &raquo;</li>

          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014-2015, Control Systems, TU-Berlin.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>